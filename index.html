<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Web Chat</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script>
        $(function() {
            var ws = new WebSocket("ws://{{.}}");

            ws.onmessage = function(e) {
                appendMsg(e.data);
            };


            $('#send-btn').click(function(){
                var data = $('#to-send').val();
                ws.send(data + "\n");
                // appendMsg(data);
                // Clear the text in the to-send field
                $('#to-send').val("");
            });
        });

        $(document).ready(function(){
            $('#to-send').keypress(function(e){
                if(e.keyCode==13)
                    $('#send-btn').click();
            });
        });

        function appendMsg(msg) {
            var msgs = $('#msg-list').val();
            msgs += msg + "\n";
            $('#msg-list').val(msgs)
            
            // scroll to end of text area to we can always see the last
            // message sent/received
            $("#msg-list").animate({
                scrollTop:$("#msg-list")[0].scrollHeight - $("#msg-list").height()
            });
        }
</script>

</head>
<body>
    <input id="to-send" type="text" />
    <input type="button" id="send-btn" value="send"></input>
    <p>
        <textarea id="msg-list" rows="10" cols="50"></textarea> 
    </p>
</body>
</html>
